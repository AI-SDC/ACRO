{smcl}
{com}{sf}{ul off}{txt}{.-}
      name:  {res}<unnamed>
       {txt}log:  {res}/Users/j4-smith/GitHub/AI-SDC/ACRO/stata/acro_demo_2026.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res}11 Feb 2026, 15:59:14

{com}. do acro_demo_2026.do
{txt}
{com}. capture program drop engage
{txt}
{com}. program engage
{txt}  1{com}.   di ""
{txt}  2{com}.   di as err "==press <return> to continue==" _request(dummy)
{txt}  3{com}.   di ""
{txt}  4{com}. end
{txt}
{com}.
.
.
. ************************************************************
. * Simple introduction to using acro for Stata researchers. *
. *                                                          *
. * Author: Jim Smith. 2026                                  *
. ************************************************************
.
. quietly {c -(}
{res} {title:ACRO demonstration}
{txt}This is a simple do-file to get you started with using the {bf:{it:acro}} package to add disclosure risk control  to your analysis.
{res}{txt}This is an interactive demonstration, so occasionally you will be prompted to hit <return> to either:
{res}{txt} - display the next piece of  information or
{res}{txt} - run the next code snippet.
{res}
{err}{bf:In displaying some of the examples below we have used the terms 'dollar' 'backtick_' and '_tick'}
{res}{err} You will need to replace them with the appropriate symbols in your actual code

==press <return> to continue=={com}.

{res} {title:A: The basic concepts}

{txt}{bf:1 A research {it:session}:}
{res}{txt}by which we mean the activity of running a series of commands (interactively or via a script) that:
{res}{txt} -  ingest some data,
{res}{txt} -  manipulate it, and then
{res}{txt} -  produce (and store) some outputs.
{res}
{txt}{bf:2 Types of commands:}
{res}{txt}Whether interactive, or just running a final script, we can think of the commands that get run in a session as dividing into:
{res}{txt} - {it:manipulation} commands that load and transform data into the shape you want
{res}{txt} - {it:feedback} commands that report on your data - but are never intended to be exported.
{res}{txt}   - in Stata these might use the variables window, or the {it:display} command
{res}{txt} - {it:query} commands that produce an output from your data (table/plot/regression model etc.)
{res}{txt}     that you might want to export from the Trusted Research Environment (TRE)
{res}
{txt} {bf:3 Risk Assessment vs decision making:}
{res}{txt} SACRO stands for Semi-Automated Checking of Research Outputs.
{res}{txt} The prefix 'Semi' is important here - because in a principles-based system humans should make {it:decisions} about output requests.
{res}{txt} To help with that we provide the SACRO-Viewer, which collates all the relevant information for them.
{res}
{txt} A key part of that information is the  {it:Risk Assessment}.
{res}{txt} - Since it involves calculating metrics and comparing them to thresholds (the TRE's risk appetite)
{res}{txt}    it can be done automatically, at the time an output query runs on the data.
{res}{txt} - This is what the ACRO tool does when you use it as part of your workflow.
{res}

{err}==press <return> to continue=={com}.

{res}{txt} {bf:4 What ACRO does}
{res}{txt} The ACRO package aims to support you in producing {it:Safe Outputs} within minimal changes to your work flow.
{res}{txt} To do that we provide:
{res}{txt} - drop-in replacements for the most commonly used {it:output commands},
{res}{txt}   - keeping the same syntax as the originals, and
{res}{txt}   - supporting as many of the options as we can
{res}{txt}       (features supported will increase over time in response to demand).
{res}{txt} - a set of {it:session-management} commands to help you manage the set of files you request for output.
{res}{txt}{bf:Important to note} that currently acro outputs results (tables, details of regression models etc.) as {it:.csv} files.
{res}{txt}   - In other words we separate the processes of {it:creating} outputs - which must be done {it:inside} the TRE.
{res}{txt}     from the process of {it:formatting} them for publication - which can be done {it:outside} the TRE with your preferred toolchain.
{res}{txt}   - ACRO handles creation. We are interested in hearing from researchers whether it is important to support them with formatting.
{res}
{txt}{bf: 5 What ACRO doesn't support (yet)}
{res}{txt} - Weightings as an option when creating tables/regressions
{res}{txt}   We would greatly appreciate input on which versions peope use most
{res}{txt}   so we can plan their implementation
{res}{txt} - Abbreviations/synonyms e.g. {cmd:reg} for {cmd:regress} etc.
{res}{txt}   this would make a nice (and easy) job for someone who wanted to get involved supporting this initiative!
{res}{txt} - Statements that combined manipulation and query commands, for example,
{res}{txt}   {it: xi: regress wage i.year age}
{res}{txt}   {bf:Workaround} You can achieve this by creating the dummy variables {bf:before} calling your query command:
{res}{txt}   {it: xi year}
{res}{txt}   {it: regress wage  backtick_ds _I*_tick age}
{res}{txt}   NB: ACRO needs to be passed an explicit list of independent variables rather than Stata's i.year shortcut
{res}{txt}   The easiest way to avoid listing the indicator variables manually is to use the macro ds_I* as shown
{res}{txt}     - Stata will expand this automatically before it gets passed to acro
{res}{txt}   See that Stata manual https://www.stata.com/manuals15/rxi.pdf for further discussion

{err}==press <return> to continue=={com}.

{res}{txt}{title:B Getting Started with the demonstration}
{res}{txt}
{res}{txt}{bf:Step 1: Setting up the environment with the tools we will use}
{res}{txt}The acro package should be installed in your system
{res}{txt} and you will just need to tell Stata where to find the {it:acro.ado} file that handles the interaction between Stata and the back-end Python package.
{res}{txt}Depending on how {it:acro} has been set up for you, this may be installed system-wide, or you may need to have it in your working directory
{res}{txt}{cmd:adopath + "."}
{res}{txt}We will also set the version of Stata to use version 18  - feel free to edit this file and change this
{res}{txt}{cmd:version 18}
{res}{txt}
{res}{txt}{title:Step 2 Starting an ACRO session}
{res}{txt} To do this we create an acro object by running the command below.
{res}{txt}
{res}{txt}{cmd:acro init, config(default) }
{res}{txt}{cmd:acro disable_suppression }
{res}{txt}
{res}{txt} You can leave out the default parameters, but this example  shows how you can:
{res}{txt} - provide the name of a {it:config} (risk appetite) file the TRE may have asked you to use
{res}{txt} - turn automatic suppression on or off right from the start of your session
{res}{txt}
{res}{txt} Note that when the cell runs it should report (in a different coloured font/background)
{res}{txt} - what version of acro is running: {bf:this should be 0.4.12}
{res}{txt} - the TRE's risk appetite: that defines the rules your outputs will be checked against.
{res}{txt} - whether suppression is automatically applied to disclosive outputs.
{res}{txt}
{err}INFO:acro:version: 0.4.12
INFO:acro:config: {c -(}'safe_threshold': 10, 'safe_dof_threshold': 10, 'safe_nk_n': 2, 'safe_nk_k': 0.9, 'safe_pratio_p': 0.1, 'check_missing_values': False, 'survival_safe_threshold': 10, 'zeros_are_disclosive': True{c )-}
INFO:acro:automatic suppression: False
{res}acro analysis session created
suppression toggled off for subsequent commands{txt}
{res}{txt}
{res}{txt}{title: Step 3: Loading some test data}
{res}{txt}
{res}{txt} The following stages in this step just do standard ingestion and manipulation commands to load some data into Stata ready to be queried.
{res}{txt} We will use some open-source data about nursery admissions.
{res}{txt}
{res}{txt} {bf:There is no change to your workflow here}
{res}{txt} - Do whatever you want in this step!
{res}{txt} - We just assume you end up with your data in Stata.
{res}{txt}{cmd:use "../data/nursery_data" }

{err}==press <return> to continue=={com}.

{res}{txt}
{res}{txt}{title:C Producing tables that are 'Safe Outputs}
{res}{txt} {bf:{it:acro}} aims to reproduce the functionality of the Stata {bf:table} command by mapping it across to the equivalent crosstab() command provided by the industry-standard Python package {it:Pandas}.
{res}{txt}{bf:Important to note} the syntax remains the same as in Stata, just with the prefix {bf:acro} - except for two differences:
{res}{txt}1. We do not currently support the weights options
{res}{txt}   - we need more input from researchers about how much of a priority these are,
{res}{txt}    especially as the functionality can be recreated by creating extra variables in Stata.
{res}{txt}2. We do not support abbreviations (creating a lookup table for this would be a nice first issue if someone wanted to contribute).
{res}{txt}
{res}{txt}The code should automatically accommodate the syntax from Stata versions <=16 and 17+
{res}{txt}  - in the examples below we will show the syntax from versions 17 and beyond,
{res}{txt} So the syntax is {bf: acro table  rowvars colvars [if] [in]  [, *]}
{res}{txt}
{res}{txt}and you can specify what the table cells contain by:
{res}{txt}    - providing a statistic - for example: mean, count, std deviation, median etc.
{res}{txt}    - specifying what variable to report on
{res}{txt} The acro version uses Stata functionality to interact with python, and all the pandas code.
{res}{txt} - but it adds extra code that checks for disclosure risks depending on the statistic you ask for.
{res}{txt}

{err}==press <return> to continue=={com}.

{res}{txt}{title:Example 1 A simple 2-D table of frequencies stratified by two variables}
{res}{txt}{cmd:acro table recommend parents}
{res}
Total
{err}INFO:acro:get_summary(): fail; threshold: 5 cells may need suppressing;
INFO:acro:outcome_df:
------------------------------------------------------------------|
parents    |great_pret   |pretentious  |usual        |Total       |
recommend  |             |             |             |            |
------------------------------------------------------------------|
not_recom  |          ok |          ok |          ok |          ok|
priority   |          ok |          ok |          ok |          ok|
recommend  | threshold;  | threshold;  | threshold;  | threshold; |
spec_prior |          ok |          ok |          ok |          ok|
very_recom | threshold;  |          ok |          ok |          ok|
Total      |          ok |          ok |          ok |          ok|
------------------------------------------------------------------|

INFO:acro:records:add(): output_0
{res}Total
-----------------------------------------------------|
parents     |great_pret  |pretentious  |usual  |Total|
recommend   |            |             |       |     |
-----------------------------------------------------|
not_recom   |1440        |1440         |1440   | 4320|
priority    | 858        |1484         |1924   | 4266|
recommend   |   0        |   0         |   2   |    2|
spec_prior  |2022        |1264         | 758   | 4044|
very_recom  |   0        | 132         | 196   |  328|
Total       |4320        |4320         |4320   |12960|
-----------------------------------------------------|


{err}==press <return> to continue=={com}.

{res}{txt}{bf:How to understand this output}
{res}{txt} The top part (in red font) is the risk analysis produced by acro.
{res}{txt} It is telling us that:
{res}{txt} - the overall summary is {bf:fail} because 4 cells are failing the 'minimum threshold' check
{res}{txt} - then it is showing which cells failed so you can choose how to respond
{res}{txt} - finally it is telling us that is has saved the table and risk assessment to our acro session with id 'output_0'
{res}{txt}
{res}{txt} The part below is the normal output produced by python mimicking the the Stata {bf:table} function.
{res}{txt} - As this is such a small table it is not hard to spot the four problematic cells with zero or low counts
{res}{txt} - but of course this might be harder for a bigger table.
{res}{txt}
{res}{txt}{bf:How to respond to this input}
{res}{txt}There are basically three choices:
{res}{txt}1. We might decide these low numbers reveal something where the public interest outweighs the disclosure risk.
{res}{txt}Rather than being a strict rules-based system, acro lets you attach an 'exception request' to a named output, to send a message to the output checkers.
{res}{txt}For example, you could type:
{res}{txt}  {cmd:acro add_exception "output_0" "I think you should let me have this because..."}
{res}{txt}
{res}{txt}2. We redesign our data so that table so that none of the cells in the resulting table represent fewer than {it:n} people (10 for the default risk appetite)
{res}{txt}For example, we could recode {it:'very_recommend'} and {it:'priority'} into one label.
{res}{txt}But maybe it is revealing that the {it:'recommend'} value is not used?
{res}{txt}
{res}{txt}3. We can redact the disclosive cells - and {bf:acro will do this for us}.
{res}{txt}We simply enable the option to suppress disclosive cells and re-run the query.
{res}{txt}
{res}{txt}The command below shows option 3.
{res}{txt}When you run the cell below you should see that:
{res}{txt} - the status now changes to {it:review} (so the output-checker knows what has been applied)
{res}{txt} - the code automatically adds an exception request saying that suppression has been applied
{res}{txt} - and, most importantly,  the cells are redacted.
{res}{txt}{cmd:acro enable_suppression }
{res}{txt}{cmd:acro table recommend parents }

{err}==press <return> to continue=={com}.

{res}suppression toggled on for subsequent commands
Total
{err}INFO:acro:get_summary(): review; threshold: 5 cells suppressed;
INFO:acro:outcome_df:
------------------------------------------------------------------|
parents    |great_pret   |pretentious  |usual        |Total       |
recommend  |             |             |             |            |
------------------------------------------------------------------|
not_recom  |          ok |          ok |          ok |          ok|
priority   |          ok |          ok |          ok |          ok|
recommend  | threshold;  | threshold;  | threshold;  | threshold; |
spec_prior |          ok |          ok |          ok |          ok|
very_recom | threshold;  |          ok |          ok |          ok|
Total      |          ok |          ok |          ok |          ok|
------------------------------------------------------------------|

INFO:acro:records:add(): output_1
INFO:acro:records:exception request was added to output_1
{res}Total
-----------------------------------------------------|
parents     |great_pret  |pretentious  |usual  |Total|
recommend   |            |             |       |     |
-----------------------------------------------------|
not_recom   |1440.0      |1440         |1440   | 4320|
priority    | 858.0      |1484         |1924   | 4266|
spec_prior  |2022.0      |1264         | 758   | 4044|
very_recom  |   NaN      | 132         | 196   |  328|
Total       |4320.0      |4320         |4318   |12958|
-----------------------------------------------------|

{txt}{title: An example of a more complex table}
{res}{txt} Just to demonstrate  the sort of tables that can be made, make something more complex.
{res}{txt}{cmd:acro enable_suppression }
{res}{txt}{cmd:acro  table (parents finance) recommend, statistic(mean children) statistic (mode children) margins('total')}
{res}{txt}
{res}{txt} Going through the parameters in order:
{res}{txt} - passing a list of variable names to 'rowvars'  (rather than a single variable/column name) tells it we want a hierarchy within the rows.
{res}{txt}   - we can do the same to columns as well (or instead) if we want to
{res}{txt} - the two {bf:statistic()} options specify reporting the  mean  (which introduces additional risks of {it:dominance})and mode  of the number of children
{res}{txt}   We are aware of (and working on) some rare issues when reporting standard devistions in a suppressed table
{res}{txt} - setting {cmd:margins(total)} tells it to display row and column sub-totals
{res}{txt}
{res}{txt} It's worth noting that including the totals there are  6 columns in the risk assessment and 5 in the suppressed table.
{res}{txt} This is because after suppression has replaced numbers with 'NaN', pandas removes the fully suppressed column ('recommend') from the table.
{res}{txt}
{res}{txt}{bf: This highlights a wider issue about Stata's inconsistent treatment of missing values}
{res}{txt}For reasons best known to itself, Stata sometimes (but not always) interprets missing numerical values as {bf:extremely high numbers}
{res}{txt}    so in one example we saw recently it reported a lot of people aged 250 years and above ...
{res}{txt}By contrast Pandas removes records with missing values if needed, which is more sane
{res}{txt} {bf: You can replicate Stata's behaviour} by explicitly mapping missing values (represented as .) to a suitably high number
{res}{txt}

{err}==press <return> to continue=={com}.

{res}suppression toggled on for subsequent commandsTotal
{err}INFO:acro:get_summary(): review; threshold: 4 cells suppressed; p-ratio: 18 cells suppressed; nk-rule: 18 cells suppressed;
INFO:acro:outcome_df:
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
                       mean                                                                                   |mode_aggfunc                                                                             |
recommend              not_recom priority recommend                      spec_prior very_recom          Total |not_recom    priority recommend                      spec_prior very_recom          Total|
parents     finance                                                                                           |                                                                                         |
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
great_pret  convenient  ok        ok                  p-ratio; nk-rule;   ok         p-ratio; nk-rule;   ok   | ok           ok                  p-ratio; nk-rule;   ok         p-ratio; nk-rule;   ok  |
            inconv      ok        ok                  p-ratio; nk-rule;   ok         p-ratio; nk-rule;   ok   | ok           ok                  p-ratio; nk-rule;   ok         p-ratio; nk-rule;   ok  |
pretentious convenient  ok        ok                  p-ratio; nk-rule;   ok                         ok  ok   | ok           ok                  p-ratio; nk-rule;   ok                         ok  ok  |
            inconv      ok        ok                  p-ratio; nk-rule;   ok                         ok  ok   | ok           ok                  p-ratio; nk-rule;   ok                         ok  ok  |
usual       convenient  ok        ok       threshold; p-ratio; nk-rule;   ok                         ok  ok   | ok           ok       threshold; p-ratio; nk-rule;   ok                         ok  ok  |
            inconv      ok        ok                  p-ratio; nk-rule;   ok                         ok  ok   | ok           ok                  p-ratio; nk-rule;   ok                         ok  ok  |
Total                   ok        ok       threshold; p-ratio; nk-rule;   ok                         ok  ok   | ok           ok       threshold; p-ratio; nk-rule;   ok                         ok  ok  |
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

INFO:acro:records:add(): output_2
INFO:acro:records:exception request was added to output_2
{res}Total
-----------------------------------------------------------------------------------------------------------------------------|
                       mean                                                |mode_aggfunc                                     |
recommend              not_recom priority  spec_prior very_recom Total     |not_recom    priority spec_prior very_recom Total|
parents     finance                                                        |                                                 |
-----------------------------------------------------------------------------------------------------------------------------|
great_pret  convenient  3.170833  2.798828  3.351293        NaN   3.160185 | 3.0          1.0      3.0        NaN        3   |
            inconv      3.116667  2.317919  3.380256        NaN   3.122222 | 3.0          1.0      3.0        NaN        1   |
pretentious convenient  3.158333  3.085938  3.250000   2.625000   3.135648 | 3.0          1.0      3.0        1.0        1   |
            inconv      3.123611  3.051676  3.364706   1.363636   3.139815 | 1.0          1.0      3.0        1.0        1   |
usual       convenient  3.105556  3.110996  3.311047   2.623077   3.111677 | 3.0          1.0      3.0        1.0        2   |
            inconv      3.130556  3.076042  3.369565   1.363636   3.098148 | 3.0          2.0      3.0        1.0        3   |
Total                   3.134259  2.986873  3.345203   2.201220   3.127952 | 1.0          1.0      3.0        1.0        3   |
-----------------------------------------------------------------------------------------------------------------------------|


{err}==press <return> to continue=={com}.

{res}{txt} {title:D What other sorts of analysis does ACRO currently support?}
{res}{txt} We are continually adding support for more types of analysis as users prioritise them.
{res}{txt}
{res}{txt} ACRO currently supports:
{res}{txt} - {bf:Tables} via {cmd:acro table ...} as described above.
{res}{txt}    - supported statistics are:  {it:mean, median, sum, std, count, mode}.
{res}{txt} - {bf:Regression}  via:  {cmd:acro regress...}, {cmd:acro logit ...} and {cmd:acro probit ...} using standard Stata syntax
{res}{txt}
{res}{txt}We are aware that
{res}{txt}-  the python and R 'front-ends' to acro support more types of analysis,
{res}{txt}-  that some Stata users would like acro to support weighted analysis.
{res}{txt}We welcome feedback, and suggestions for the next prioritise the development team.
{res}{txt}Offers to contribute code are especially welcome!
{res}{txt}There is more help on how to use all of these available from the {it:acro cheat sheet} or (if have have internet access) from www.sacro-tools.org

{err}==press <return> to continue=={com}.

{res}{txt}
{res}{txt}{title: E ACRO functionality to let users manage their outputs}
{res}{txt}
{res}{txt} As explained above, you need to create an {it:acro session} whenever your code is run.
{res}{txt}
{res}{txt} After that, every time you run an acro {it:query} command both the output and the risk assessment are saved as part of the acro session.
{res}{txt}
{res}{txt} But we recognise that:
{res}{txt} - You may not want to request release of all your outputs - for example, the first table we produced above.
{res}{txt} - It is  good practice to provide a more informative name than just {it:output_n} for the .csv files that acro produces
{res}{txt} - It helps the output checker if you provide some comments saying what the outputs are.
{res}{txt} - You might want to add more things to the bundles of files you want to take out, such as:
{res}{txt}    - outputs from analyses that acro doesn't currently support
{res}{txt}    - your code itself (which many journals want)
{res}{txt}    - maybe a version of your paper in pdf/word format etc.
{res}{txt}
{res}{txt} Therefore acro provides the following commands for  'session management'
{res}{txt}
{res}{txt}{bf: 1 Listing the  current contents of an  ACRO session}
{res}{txt} This output is not beautiful (there's a GUI come soon) but should let you identify outputs you want to rename,comment on, or delete
{res}{txt}{cmd:acro print_outputs}

{err}==press <return> to continue=={com}.

{res}uid: output_0
status: fail
type: table
properties: {c -(}'method': 'crosstab'{c )-}
sdc: {c -(}'summary': {c -(}'suppressed': False, 'negative': 0, 'missing': 0, 'threshold': 5, 'p-ratio': 0, 'nk-rule': 0, 'all-values-are-same': 0{c )-}, 'cells': {c -(}'negative': [], 'missing': [], 'threshold': [[2, 0], [2, 1], [2, 2], [2, 3], [4, 0]], 'p-ratio': [], 'nk-rule': [], 'all-values-are-same': []{c )-}{c )-}
command: safe_output = stata_config.stata_acro.crosstab(
summary: fail; threshold: 5 cells may need suppressing;
outcome: parents      great_pret  pretentious        usual        Total
recommend
not_recom            ok           ok           ok           ok
priority             ok           ok           ok           ok
recommend   threshold;   threshold;   threshold;   threshold;
spec_prior           ok           ok           ok           ok
very_recom  threshold;            ok           ok           ok
Total                ok           ok           ok           ok
output: [parents     great_pret  pretentious  usual  Total
recommend
not_recom         1440         1440   1440   4320
priority           858         1484   1924   4266
recommend            0            0      2      2
spec_prior        2022         1264    758   4044
very_recom           0          132    196    328
Total             4320         4320   4320  12960]
timestamp: 2026-02-11T15:59:32.691524
comments: []
exception:

uid: output_1
status: review
type: table
properties: {c -(}'method': 'crosstab'{c )-}
sdc: {c -(}'summary': {c -(}'suppressed': True, 'negative': 0, 'missing': 0, 'threshold': 5, 'p-ratio': 0, 'nk-rule': 0, 'all-values-are-same': 0{c )-}, 'cells': {c -(}'negative': [], 'missing': [], 'threshold': [[2, 0], [2, 1], [2, 2], [2, 3], [4, 0]], 'p-ratio': [], 'nk-rule': [], 'all-values-are-same': []{c )-}{c )-}
command: safe_output = stata_config.stata_acro.crosstab(
summary: review; threshold: 5 cells suppressed;
outcome: parents      great_pret  pretentious        usual        Total
recommend
not_recom            ok           ok           ok           ok
priority             ok           ok           ok           ok
recommend   threshold;   threshold;   threshold;   threshold;
spec_prior           ok           ok           ok           ok
very_recom  threshold;            ok           ok           ok
Total                ok           ok           ok           ok
output: [parents     great_pret  pretentious  usual  Total
recommend
not_recom       1440.0         1440   1440   4320
priority         858.0         1484   1924   4266
spec_prior      2022.0         1264    758   4044
very_recom         NaN          132    196    328
Total           4320.0         4320   4318  12958]
timestamp: 2026-02-11T15:59:34.589461
comments: []
exception: Suppression automatically applied where needed

uid: output_2
status: review
type: table
properties: {c -(}'method': 'crosstab'{c )-}
sdc: {c -(}'summary': {c -(}'suppressed': True, 'negative': 0, 'missing': 0, 'threshold': 4, 'p-ratio': 18, 'nk-rule': 18, 'all-values-are-same': 0{c )-}, 'cells': {c -(}'negative': [], 'missing': [], 'threshold': [[4, 2], [4, 8], [6, 2], [6, 8]], 'p-ratio': [[0, 2], [0, 4], [0, 8], [0, 10], [1, 2], [1, 4], [1, 8], [1, 10], [2, 2], [2, 8], [3, 2], [3, 8], [4, 2], [4, 8], [5, 2], [5, 8], [6, 2], [6, 8]], 'nk-rule': [[0, 2], [0, 4], [0, 8], [0, 10], [1, 2], [1, 4], [1, 8], [1, 10], [2, 2], [2, 8], [3, 2], [3, 8], [4, 2], [4, 8], [5, 2], [5, 8], [6, 2], [6, 8]], 'all-values-are-same': []{c )-}{c )-}
command: safe_output = stata_config.stata_acro.crosstab(
summary: review; threshold: 4 cells suppressed; p-ratio: 18 cells suppressed; nk-rule: 18 cells suppressed;
outcome:                             mean           ...        mode_aggfunc
recommend              not_recom priority  ...          very_recom Total
parents     finance                        ...
great_pret  convenient        ok       ok  ...  p-ratio; nk-rule;     ok
            inconv            ok       ok  ...  p-ratio; nk-rule;     ok
pretentious convenient        ok       ok  ...                  ok    ok
            inconv            ok       ok  ...                  ok    ok
usual       convenient        ok       ok  ...                  ok    ok
            inconv            ok       ok  ...                  ok    ok
Total                         ok       ok  ...                  ok    ok

[7 rows x 12 columns]
output: [                            mean            ... mode_aggfunc
recommend              not_recom  priority  ...   very_recom Total
parents     finance                         ...
great_pret  convenient  3.170833  2.798828  ...          NaN     3
            inconv      3.116667  2.317919  ...          NaN     1
pretentious convenient  3.158333  3.085938  ...          1.0     1
            inconv      3.123611  3.051676  ...          1.0     1
usual       convenient  3.105556  3.110996  ...          1.0     2
            inconv      3.130556  3.076042  ...          1.0     3
Total                   3.134259  2.986873  ...          1.0     3

[7 rows x 10 columns]]
timestamp: 2026-02-11T15:59:35.695347
comments: []
exception: Suppression automatically applied where needed



{err}==press <return> to continue=={com}.

{res}{txt}{bf:2 Remove some ACRO outputs before finalising}
{res}{txt} At the start of this demo we made a disclosive output -it's the first one with status {it:fail}.
{res}{txt}
{res}{txt} We don't want to waste the output checker's time so lets remove it.
{res}{txt}{cmd:acro remove_output "output_0"}
{err}INFO:acro:records:remove(): output_0 removed

==press <return> to continue=={com}.

{res}{txt}{bf: 3 Rename ACRO outputs before finalising}
{res}{txt} This is an example of renaming the outputs to provide  more descriptive names.
{res}{txt}{cmd:rename_output output_1 "crosstab_recommendation_vs_parents"}
{res}{txt}{cmd:rename_output output_2 "mean_children_by_parents_finance_recommendation"}
{err}INFO:acro:records:rename_output(): output_1 renamed to crosstab_recommendation_vs_parents
{res}output output_1 renamed to crosstab_recommendation_vs_parents.
{err}INFO:acro:records:rename_output(): output_2 renamed to mean_children_by_parents_finance_recommendation
{res}output output_2 renamed to mean_children_by_parents_finance_recommendation.

{err}==press <return> to continue=={com}.

{res}{txt}{bf: 4 Add a comment to output}
{res}{txt} This is an example of adding a comment to outputs.
{res}{txt} It can be used to provide a description or to pass additional information to the TRE staff.
{res}{txt} They will see it alongside your file in the output checking viewer - rather than having it in an email somewhere.
{res}{txt}
{res}{txt}{cmd:acro add_comments "mean_children_by_parents_finance_recommendation" "too few cases of recommend to report"}
{err}INFO:acro:records:a comment was added to mean_children_by_parents_finance_recommendation
{res}Comments added to output mean_children_by_parents_finance_recommendation.

{err}==press <return> to continue=={com}.

{res}{txt}{bf: 5. Request an exception}
{res}{txt} An example of providing a reason why an exception should be made
{res}{txt}e.g.: {cmd:acro add_exception "output_n" "This is evidence of systematic bias"}

{err}==press <return> to continue=={com}.

{res}{txt}{bf: 6 Adding a custom output.}
{res}{txt} As mentioned above you might want to request release of all sorts of things
{res}{txt} - including your code,
{res}{txt} - or outputs from analyses *acro* doesn't support (yet)
{res}{txt}'
{res}{txt} In ACRO we can add a file to our session with a comment describing what it is.
{res}{txt}{cmd:acro custom_output "acro_demo_2026.do" "this is the code that produced this session"}
{err}INFO:acro:records:add_custom(): output_3
{res}file acro_demo_2026.do with comment This is the code that produced this session added to session.
{err}==press <return> to continue=={com}.

{res}{txt} {title:F Finishing your session and producing a folder of files to release.}
{res}{txt} This is an example of the function {bf:finalise()} which the users must call at the end of each session.
{res}{txt} - It takes each output and saves it to a CSV file (or the original file type for custom outputs)
{res}{txt} - It also saves the SDC analysis for each output to a json file.
{res}{txt} - It adds checksums for everything - so we know they've not been edited.
{res}{txt} - It puts them all in a folder with the name you supply.
{res}{txt}
{res}{txt} {bf:ACRO will not overwrite previous sessions}
{res}{txt}
{res}{txt} So every time you call finalise on a session you need to either:
{res}{txt}   - delete the previous folder (by adding Stata commands to remove), or
{res}{txt}   - provide a new folder name manually, or
{res}{txt} - create a const (e.g. macro) programmatically to hold the folder name
{res}
{txt}The code snippet below shows how to add the current time and date to a folder name.
{res}{txt}Please remember the comments above about substituting symbols for dollar backtick_ and _tick
{res}{txt}{cmd:local suffix = subinstr("dollarS_DATE", " ", "_", .) + "_" + subinstr("dollarS_TIME",":","_",.)}
{res}{txt}{cmd:local myfoldername= "my_acro_outputs_v1_" + "backtick_suffix_tick"}
{res}{txt}{cmd:acro finalise "backtick_myfoldername_tick"}
{err}INFO:acro:records:outputs written to: my_acro_outputs_v1_11_Feb_2026_15_59_53
{res}outputs and stata_outputs.json written
{txt}
{com}.
.
.
.
{txt}end of do-file

{com}. log close
      {txt}name:  {res}<unnamed>
       {txt}log:  {res}/Users/j4-smith/GitHub/AI-SDC/ACRO/stata/acro_demo_2026.smcl
  {txt}log type:  {res}smcl
 {txt}closed on:  {res}11 Feb 2026, 16:00:03
{txt}{.-}
{smcl}
{txt}{sf}{ul off}
